import{initializeApp}from"https://www.gstatic.com/firebasejs/9.18.0/firebase-app.js";import{getDatabase,ref,child,get,update}from"https://www.gstatic.com/firebasejs/9.18.0/firebase-database.js";const firebaseConfig={apiKey:"AIzaSyA2vVGK5q7CCIogSzjWmS3W1dwXWIaNx54",authDomain:"arlokastu.firebaseapp.com",databaseURL:"https://arlokastu-default-rtdb.asia-southeast1.firebasedatabase.app",projectId:"arlokastu",storageBucket:"arlokastu.appspot.com",messagingSenderId:"380938305623",appId:"1:380938305623:web:7e29194c2b17940611e312"},app=initializeApp(firebaseConfig),db=getDatabase(),fRtdb=async()=>{const t=sessionStorage.getItem("_shortL");if(t){const e=JSON.parse(t),a="stu/"+e.by+"/"+e.id+"/";if(await get(child(ref(db),a+"ori")).then(t=>!!t.exists()&&t.val()==e.ori).catch(()=>!1)){const t=new Date,c=t.getFullYear(),i=String(t.getMonth()+1).padStart(2,"0"),s=String(t.getDate()).padStart(2,"0"),r=[c,i].join("-");let l=await get(child(ref(db),"userLevel/"+e.by+"/level")).then(t=>t.exists()&&t.val()).catch(()=>!1);l&&(l=await get(child(ref(db),"config/stu/level/"+l+"/cpc")).then(t=>t.exists()?t.val():1));const n=await get(child(ref(db),"config/stu/cpc")).then(t=>t.exists()?t.val():1),o=l||n;document.querySelectorAll(".icdbx").forEach(t=>{t.addEventListener("click",async()=>{if(stVC()&&t.classList.contains("a")){const t=await get(child(ref(db),a+"click")).then(t=>t.exists()?t.val()+1:1).catch(()=>1),c=await get(child(ref(db),"/reports/"+e.by+"/"+r+"/"+s)).then(t=>{let e=t.val();return{click:e.click+1,cpc:(e.click*e.cpc+o)/(e.click+1)}}).catch(()=>({click:1,cpc:o})),i=await get(child(ref(db),"/balance/"+e.by+"/current")).then(t=>t.val()+o).catch(()=>o),l={};l["/"+a+"click"]=t,l["/reports/"+e.by+"/"+r+"/"+s+"/click"]=c.click,l["/reports/"+e.by+"/"+r+"/"+s+"/cpc"]=c.cpc,l["/balance/"+e.by+"/current"]=i,update(ref(db),l).then(()=>inVC()).catch(t=>t.message)}})})}}};fRtdb();
